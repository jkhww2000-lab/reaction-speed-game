<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë°˜ì‘ì†ë„ í…ŒìŠ¤íŠ¸</title>
  <style>
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #222;
      font-family: Arial, sans-serif;
      color: white;
    }

    #stats {
      position: fixed;
      top: 15px;
      right: 20px;
      font-size: 14px;
      text-align: right;
      line-height: 1.5;
    }

    #shareBtn {
      margin-top: 6px;
      padding: 4px 8px;
      font-size: 12px;
      cursor: pointer;
      border-radius: 6px;
      border: none;
    }

    #box {
      width: 320px;
      height: 320px;
      background-color: green;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 20px;
      cursor: pointer;
      user-select: none;
      text-align: center;
      border-radius: 14px;
      white-space: pre-line;
      transition: transform 0.1s;
    }

    .flash {
      animation: flash 0.3s ease-in-out 3;
    }

    @keyframes flash {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body>

<div id="stats">
  ì‹œë„ íšŸìˆ˜: <span id="count">0</span><br>
  í‰ê· : <span id="average">-</span><br>
  ìµœê³ (ë¹ ë¦„): <span id="best">-</span><br>
  ìµœì €(ëŠë¦¼): <span id="worst">-</span><br>
  <span id="avgMessage" style="font-size:12px; color:#ccc;"></span><br>
  <span id="grade" style="font-size:13px; font-weight:bold;"></span><br>
  <button id="shareBtn">ğŸ“¸ ê¸°ë¡ ê³µìœ </button>
</div>

<div id="box">í´ë¦­í•˜ë©´ ì‹œì‘</div>

<!-- html2canvas CDN -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
  const box = document.getElementById("box");
  const countEl = document.getElementById("count");
  const avgEl = document.getElementById("average");
  const bestEl = document.getElementById("best");
  const worstEl = document.getElementById("worst");
  const avgMsgEl = document.getElementById("avgMessage");
  const gradeEl = document.getElementById("grade");
  const shareBtn = document.getElementById("shareBtn");

  let startTime = 0;
  let timeoutId = null;
  let waiting = false;

  let tryCount = 0;
  let totalReaction = 0;
  let bestRecord = null;
  let worstRecord = null;

  function getMessage(ms) {
    if (ms <= 50) return "í˜¹ì‹œ ì¸ê°„ ë§ìœ¼ì„¸ìš”? AI ì˜ì‹¬ë©ë‹ˆë‹¤.";
    if (ms <= 100) return "ì‹ ê²½ì´ ë¹›ì˜ ì†ë„ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤. ì‹ ê¸‰ ë°˜ì‘.";
    if (ms <= 150) return "í”„ë¡œê²Œì´ë¨¸ ì…ë‹¨ í…ŒìŠ¤íŠ¸ í†µê³¼.";
    if (ms <= 200) return "ê³¨í‚¤í¼ í•´ë„ ê³µì´ ë¨¼ì € í¬ê¸°í•˜ê² ì–´ìš”.";
    if (ms <= 250) return "ì •í™•íˆ í‰ê· . êµê³¼ì„œì ì¸ ë°˜ì‘ì†ë„.";
    if (ms <= 300) return "ì‚´ì§ ë…¹ìŠ¬ì—ˆìŠµë‹ˆë‹¤. ê¸°ë¦„ì¹  í•˜ê³ ì˜¤ì„¸ìš”.";
    if (ms <= 350) return "ëˆˆì€ ë´¤ëŠ”ë° ì†ì´ íšŒì˜ ì¤‘ì…ë‹ˆë‹¤.";
    if (ms <= 400) return "ì‹ ê²½ ì „ë‹¬ì´ ì§€ê°í–ˆìŠµë‹ˆë‹¤. ì‚¬ìœ ì„œ ì œì¶œ ìš”ë§.";
    if (ms <= 450) return "ì´ì •ë„ë©´ ì°¨ì— ì¹˜ì–´ë„ ë‹¤ìŒë‚  ë³‘ì›ê°€ì‹œê² ì–´ìš”.";
    if (ms <= 500) return "í˜¹ì‹œ í´ë¦­ ì „ì— ì¸ìƒì„ í•œ ë²ˆ ëŒì•„ë³´ì…¨ë‚˜ìš”?";
    return "ì´ê±´ ëˆŒëŸ¬ì•¼ë˜ëŠ”ì§€ ì•„ë‹Œì§€ ì˜ë…¼í•˜ê³  ëˆ„ë¥¸ìˆ˜ì¤€ì…ë‹ˆë‹¤.";
  }

  function getGrade(avg) {
    if (avg <= 120) return "ì˜¤ëŠ˜ì˜ ë‡Œ ì»¨ë””ì…˜: S";
    if (avg <= 160) return "ì˜¤ëŠ˜ì˜ ë‡Œ ì»¨ë””ì…˜: A";
    if (avg <= 200) return "ì˜¤ëŠ˜ì˜ ë‡Œ ì»¨ë””ì…˜: B";
    if (avg <= 250) return "ì˜¤ëŠ˜ì˜ ë‡Œ ì»¨ë””ì…˜: C";
    if (avg <= 320) return "ì˜¤ëŠ˜ì˜ ë‡Œ ì»¨ë””ì…˜: D";
    return "ì˜¤ëŠ˜ì˜ ë‡Œ ì»¨ë””ì…˜: F";
  }

  box.addEventListener("click", () => {
    if (!waiting) {
      box.style.backgroundColor = "green";
      box.textContent = "ê¸°ë‹¤ë¦¬ì„¸ìš”...";
      waiting = true;

      const randomDelay = Math.random() * 7000 + 3000;

      timeoutId = setTimeout(() => {
        box.style.backgroundColor = "red";
        box.textContent = "ì§€ê¸ˆ í´ë¦­!";
        startTime = performance.now();
      }, randomDelay);

    } else {
      if (box.style.backgroundColor !== "red") {
        clearTimeout(timeoutId);
        box.textContent = "ë„ˆë¬´ ë¹¨ëì–´ìš”!\nì‹ ê²½ì´ ë„ˆë¬´ ì•ì§ˆë €ìŠµë‹ˆë‹¤";
        waiting = false;
        return;
      }

      const reactionTime = performance.now() - startTime;
      const message = getMessage(reactionTime);

      tryCount++;
      totalReaction += reactionTime;
      const average = totalReaction / tryCount;

      // ìµœê³ /ìµœì € ê¸°ë¡ ê´€ë¦¬
      bestRecord = bestRecord === null ? reactionTime : Math.min(bestRecord, reactionTime);
      worstRecord = worstRecord === null ? reactionTime : Math.max(worstRecord, reactionTime);

      countEl.textContent = tryCount;
      avgEl.textContent = `${average.toFixed(0)} ms`;
      bestEl.textContent = `${bestRecord.toFixed(0)} ms`;
      worstEl.textContent = `${worstRecord.toFixed(0)} ms`;
      avgMsgEl.textContent = getMessage(average);
      gradeEl.textContent = getGrade(average);

      let bestText = "";
      if (reactionTime === bestRecord) {
        bestText = "\n\nğŸ† ìµœê³  ê¸°ë¡ ê°±ì‹ !";
        box.classList.add("flash");
        setTimeout(() => box.classList.remove("flash"), 500);
      }

      box.textContent = `ë°˜ì‘ì†ë„: ${reactionTime.toFixed(0)} ms\n${message}${bestText}\n\në‹¤ì‹œ í´ë¦­í•´ì„œ ì¬ë„ì „`;
      box.style.backgroundColor = "green";
      waiting = false;
    }
  });

  // ìŠ¤í¬ë¦°ìƒ· ê³µìœ 
  shareBtn.addEventListener("click", () => {
    html2canvas(document.body).then(canvas => {
      const link = document.createElement('a');
      link.download = 'reaction-result.png';
      link.href = canvas.toDataURL();
      link.click();
    });
  });
</script>

</body>
</html>
